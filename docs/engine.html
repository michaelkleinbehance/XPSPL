<!DOCTYPE html>
<head>
<title>
   Prggmr v0.2.0 Engine Documentation
</title>
<link href="style.css" type="text/css" rel="stylesheet" media="all" />
<link href="js/google-code-prettify/prettify.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="js/google-code-prettify/prettify.js"></script>
</head>
<body onload="prettyPrint()">
<h1>
    Prggmr Documentation &amp; Manual v0.2.0
</h1>
<a href="index.html">Index</a>
<h2>
    Engine
</h2>
<p>
    The engine object is responsible for maintaining <a href="#engine.queue">Queues</a> and
    ensuring I/O data conforms to prggmr specifications, it also provides functionality to
    run a <a href="#engine.daemon_mode">daemon mode</a>.
</p>
<h3>
    Constants
</h3>
<ul>
    <li>
        <span>RUNNING</span> engine is in a running state.
    </li>
    <li>
        <span>DAEMON</span> engine is in daemon mode.
    </li>
    <li>
        <span>SHUTDOWN</span> engine has been shutdown. This does not indicate an error.
    </li>
    <li>
        <span>ERROR</span> engine has encountered an error.
    </li>
    <li>
        <span>DAEMON_SHUTDOWN_TIMEOUT</span> daemon shutdown signal timeout.
</ul>
<h3 id="engine.__construct">
    __construct()
</h3>
<p>
    Object constructor takes no parameters 
</p>
<p>
    Internally readies the engine by empting all storages and setting the engines
    state to <span>RUNNING</span>
</p>
<h4>Example</h4>
<div class="code">
<pre class="prettyprint php">
$engine = new \prggmr\Engine();
</pre>
</div>
<h3 id="engine.subscribe">
    subscribe(signal, subscription, [identifier, priority, chain, exhaust])
</h3>
<p>
    Creates a subscription to the given signal.
</p>
<p>
    Returns the <a href="subscription.html#object">subscription</a> object sent to the queue.
</p>
<h4>Parameters</h4>
<ul>
    <li>
        The event signal. Refer to <a href="signal.html">signals</a> for more info.
    </li>
    <li>
        An anonymous function, a <a href="subscription.html#object">Subscription</a> object or a php callable. Refer to <a href="subscription.html">subscriptions</a> for more info.
    </li>
    <li>
        A string used for later identifing the subscription, if not provided a random integer will be generated, and so the ability to identify this subscription.
    </li>
    <li>
        Integer in ASC order which determains the firing order in queue.
    </li>
    <li>
        Signal to chain once this subscription completes. Refer to <a href="chains.html#subscriber">chains</a> for more info.
    </li>
    <li>
        The number of times this subscription will fire before being dumped. Defaults to 0 (infinte).
    </li>
</ul>
<h4>
    Exceptions
</h4>
<ul>
    <li>
        InvalidArgumentException
    </li>
</ul>
<h4>Example</h4>
<div class="code">
<pre class="prettyprint php">
$engine = new \prggmr\Engine();
// subscribe to the "hello.world" event
$engine->subscribe("hello.world", function($event){
    echo "HelloWorld";
});
$engine->fire('hello.world');
</pre>
</div>
<h3 id="engine.dequeue">
    dequeue(signal, subscriber)
</h3>
<p>
    Removes a subscriber from an event signal. 
</p>
<h4>Parameters</h4>
<ul>
    <li>
        The signal that the subscriber is listening on.
    </li>
    <li>
        Subscriber to remove, this must be either the identifier or the subscription object.
    </li>
</ul>
<h4>Example</h4>
<div class="code">
<pre class="prettyprint php">
$engine = new \prggmr\Engine();
$subcriber = $engine->subscribe('test', function(){
    echo "HelloWorld";
}, 'my-function');
// fire
$engine->fire('test');
// dequeue
$engine->dequeue('test', 'my-function');
// nothing outputs
$engine->fire('test');
</pre>
</div>
<h3 id="engine.queue">
    queue(signal, [generate])
</h3>
<p>
    Used internally for managing queue objects by generating or returning
    stored queues based on the provided signal.
</p>
<p>
    Refer to <a href="queue.html">queues</a> for more info regarding queues.
</p>
<p>
    This will return false if a queue cannot be found and one is not to be generated.
</p>
<h4>Parameters</h4>
<ul>
    <li>
        The signal the queue represents.
    </li>
    <li>
        Generate a new queue if one is not found. Defaults to true.
    </li>
</ul>
<h4>Example</h4>
<div class="code">
<pre class="prettyprint php">
$engine = new \prggmr\Engine();
// get the 'test' signal queue.
$queue = $engine->queue('test');
// dump the number of subscribers
echo $queue->count();
</pre>
</div>
<h3 id="engine.fire">
    fire(signal, [vars, event])
</h3>
<p>
    Fires a event signal.
</p>
<h4>Parameters</h4>
<ul>
    <li>
        The event signal to fire. Refer to <a href="signal.html">signals</a> for more info.
    </li>
    <li>
        A list of variables to pass the subscription.
        <div class="notice">
            <p>
                This is expected as an array, if passed an array it will interupt it as the variable list.
                To workaround this limitation array parameters must be provided within a parent array if attempting
                to pass an array as a variable on its own.
            </p>
        </div>
        <div class="code">
        <pre class="prettyprint php">
subscribe('test', function($event, $var){
    var_dump($var);
});

// without parent vars recieved as param list
fire('test', array('var1','var2'));

// with parent works as expected
fire('test', array(array('var1', 'var2')));
        </pre>
        </div>
    </li>
    <li>
        event is a <a href="event.html">Event</a> object to use for the event.
    </li>
</ul>
<p>
    Returns an <a href="event.html">Event</a> object.
</p>
<h4>Examples</h4>
<div class="code">
<pre class="prettyprint php">
$engine = new \prggmr\Engine();

/**
 * Fire an event with no additional params.
 */
 
// first subscribe
$engine->subscribe('HelloWorld', function($event){
    echo "HelloWorld";
}, 'one');

// fire the HelloWorld event
$engine->fire('HelloWorld');

// remove the subscriber
$engine->dequeue('HelloWorld', 'one');


/**
 * Firing providing the event parameters
 */
 
// Subcribe with multi params
$engine->subscribe('HelloWorld', function($event, $param1, $param2){
    echo $param1.$param2;
}, 'params');

// fire HelloWorld passing params
$engine->fire('HelloWorld', array('Hello', 'World'));

// remove the subscriber
$engine->dequeue('HelloWorld', 'params');


/**
 * Fire using a provided event object
 */
// subscribe for a custom event
$engine->subscribe('HelloWorld', function($event){
    echo $event->getData('hello');
});

// inst a new event
$event = new \prggmr\Event();
$event->setData('HelloWorld', 'hello');

// fire with a custom event object as the third param
$engine->fire('HelloWorld', null, $event);
</pre>
</div>
<h3 id="engine.flush">
    flush()
</h3>
<p>
    Flushes the engines internal storages.
</p>
<h4>Example</h4>
<div class="code">
<pre class="prettyprint php">
$engine = new \prggmr\Engine();
$engine->flush();
</pre>
</div>
<h3 id="engine.count">
    count()
</h3>
<p>
    Returns a count of the total queues stored in the engine.
</p>
<h4>Example</h4>
<div class="code">
<pre class="prettyprint php">
$engine = new \prggmr\Engine();
echo $engine->count();
</pre>
</div>
<h3 id="engine.getstate">
    getState()
</h3>
<p>
    Returns the current engines state.
</p>
<h4>Example</h4>
<div class="code">
<pre class="prettyprint php">
$engine = new \prggmr\Engine();
if ($engine->getState() == \prggmr\Engine::RUNNING) {
    echo 'The engine is hot!';
}
</pre>
</div>
<h3 id="engine.canindex">
    canIndex(variable)
</h3>
<p>
    Determains if the provided var is indexable by the engine.
</p>
<h4>Parameters</h4>
<ul>
    <li>
        The variable to check.
    </li>
</ul>
<h4>Example</h4>
<div class="code">
<pre class="prettyprint php">
$engine = new \prggmr\Engine();
if ($engine->canIndex('string')) {
    // use it as an index its fast!
}
</pre>
</div>
<h2 id="engine.daemon_mode">
    Daemon Mode
</h2>
<p>
    Daemon mode allows for running prggmr as a daemon with timer based events avaliable.
    It has two possible entry points the first and recommended public api function
    <a href="api.html#api.prggmrd">prggmrd</a>, and the engine method <a href="#engine.daemon">daemon</a>.
</p>
<div class="notice">
    <p>
        The following methods will work ONLY while in daemon mode, all times are in milliseconds.
    </p>
</div>
<h3 id="engine.counttimers">
    countTimers()
</h3>
<p>
    Returns a count of the timed subscribers.
</p>
<h4>Example</h4>
<div class="code">
<pre class="prettyprint php">
$engine = new \prggmr\Engine();
$engine->countTimers();
</pre>
</div>
<h3 id="engine.setinterval">
    setInterval(subscription, interval, [vars, identifier, exhaust])
</h3>
<p>
    Sets a function to call at the given interval.
</p>
<p>
    Returns the subscription object.
</p>
<h4>Parameters</h4>
<ul>
    <li>
        An anonymous function, a <a href="subscription.html#object">Subscription</a> object or a php callable. Refer to <a href="subscription.html">subscriptions</a> for more info.
    </li>
    <li>
        The amount of time in seconds between calls.
    </li>
    <li>
        A list of variables to pass to the subscription.
    </li>
    <li>
        A string used for later identifing the subscription, if not provided a random integer will be generated, and so the ability to identify this subscription.
    </li>
    <li>
        Number of times this subscription will fire before being automatically removed by the engine.
    </li>
</ul>
<h4>Example</h4>
<p>
    The example below keeps a count of the number of seconds it has run and prints it out.
</p>
<div class="code">
<pre class="prettyprint php">
$engine = new \prggmr\Engine();
$count = 0;
$engine->setInterval(function($event, $count){
    echo sprintf(
        "Running for %d seconds now ... \n",
        $count++
    );
}, 1000, array(&$count));

// start it all
$engine->daemon();
</pre>
</div>
<h3 id="engine.settimeout">
    setTimeout(subscription, interval, [vars, identifier])
</h3>
<p>
    Calls a function after the given time in milliseconds has passed.
</p>
<p>
    Returns the subscription object.
</p>
<h4>Parameters</h4>
<ul>
    <li>
        An anonymous function, a <a href="subscription.html#object">Subscription</a> object or a php callable. Refer to <a href="subscription.html">subscriptions</a> for more info.
    </li>
    <li>
        The amount of time in seconds between calls.
    </li>
    <li>
        A list of variables to pass to the subscription.
    </li>
    <li>
        A string used for later identifing the subscription, if not provided a random integer will be generated, and so the ability to identify this subscription.
    </li>
</ul>
<h4>Example</h4>
<p>
    The example below kills the daemon after 5 seconds.
</p>
<div class="code">
<pre class="prettyprint php">
$engine = new \prggmr\Engine();
$count = 0;
$engine->setTimeout(function($event) use ($engine){
    echo "Shutting down";
    $engine->shutdown();
}, (1000 * 5), array(&$count));

// start it all
$engine->daemon();
</pre>
</div>
<h3 id="engine.clearinterval">
    clearInterval(subscription)
</h3>
<p>
    Clears a interval function.
</p>
<h4>Parameters</h4>
<ul>
    <li>
        The interval identifier or subscription object.
    </li>
</ul>
<h4>Example</h4>
<div class="code">
<pre class="prettyprint php">
$engine = new \prggmr\Engine();
$count = 0;
// start a new interval
$engine->setInterval(function(){
}, 1000, null, 'helloworld');

// set a timeout to clear the interval after 5 seconds
$engine->setTimeout(function() use ($engine){
    $engine->clearInterval('helloworld');
}, 5000);

// start it all
$engine->daemon();
</pre>
</div>
<h3 id="engine.clearinterval">
    clearTimeout(subscription)
</h3>
<p>
    Clears a timeout function.
</p>
<h4>Parameters</h4>
<ul>
    <li>
        The timeout identifier or subscription object.
    </li>
</ul>
<h4>Example</h4>
<div class="code">
<pre class="prettyprint php">
$engine = new \prggmr\Engine();
$count = 0;
// set a new timeout
$engine->setInterval(function(){
    echo "HelloWorld";
}, 10000, null, 'helloworld');

// clear the timeout a second before it fires
$engine->setTimeout(function() use ($engine){
    $engine->clearTimeout('helloworld');
}, 9000);

// start it all
$engine->daemon();
</pre>
</div>
<h3 id="engine.daemon">
    daemon([reset, timeout])
</h3>
<p>
    Runs the engine in daemon mode.
</p>
<p>
    Refer to <a href="daemon.html">daemon</a> for more info.
</p>
<h4>Parameters</h4>
<ul>
    <li>
        When true all timers are reset to have a start time in sync with the daemon.
    </li>
    <li>
        Time in milliseconds to run the daemon.
    </li>
</ul>
<h4>Example</h4>
<div class="code">
<pre class="prettyprint php">
$engine = new \prggmr\Engine();

// GO GO GO
$engine->daemon();
</pre>
</div>
<h3 id="engine.shutdown">
    shutdown()
</h3>
<p>
    Sends the daemon the shutdown signal.
</p>
<h4>Example</h4>
<div class="code">
<pre class="prettyprint php">
$engine = new \prggmr\Engine();

$engine->setTimeout(function() use($engine){
    // shutdown the engine
    $engine->shutdown();
}, 1000);

// GO GO GO
$engine->daemon();
</pre>
</div>
<h2 id="protected">
    Protected Methods
</h2>
<h3 id="engine.daemon">
    _fire(signal, subscription, vars)
</h3>
<p>
    Internally handles the firing of all prggmr events.
</p>
<h4>Parameters</h4>
<ul>
    <li>
        The signal object being fired unless it is a timer in which it is null.
    </li>
    <li>
        The subscription object.
    </li>
    <li>
        An array of variables being passed to the event.
    </li>
</ul>
</body>
</html>